# v0.7 Requirements: Journaled Task System

Extracted from [v0.7-journaled-tasks.md](v0.7-journaled-tasks.md).

## Task Primitive

| ID | Description |
|----|-------------|
| T1 | `(task id expr)` form is a new special form in PTC-Lisp |
| T2 | `id` must be a string literal; unquoted symbols are rejected by the analyzer |
| T3 | If `id` exists in journal, return cached value and skip `expr` |
| T4 | If `id` is missing from journal, evaluate `expr` and commit result to journal |
| T5 | `(task)` evaluates to the result of `expr` (transparent semantics) |
| T6 | On `(fail ...)` or crash inside `expr`, do NOT commit to journal |
| T7 | On `(fail ...)` or crash inside `expr`, propagate failure up (halt execution) |

## Journal

| ID | Description |
|----|-------------|
| J1 | `journal` is a new dedicated field on the `Context` struct |
| J2 | Journal is a plain map with string keys |
| J3 | `Step` struct gets a new `journal` field containing the updated journal |
| J4 | Engine stores values as-is; no serialization constraints imposed |

## Progressive Enhancement

| ID | Description |
|----|-------------|
| P1 | If `context.journal` is nil/missing, `(task)` executes `expr` normally without caching |
| P2 | Emit a trace warning when `(task)` runs without a journal |

## Mission Log

| ID | Description |
|----|-------------|
| M1 | Auto-inject a "Mission Log" section into the system prompt when journal is non-empty |
| M2 | Only show completed (successfully committed) tasks |
| M3 | Truncate result values to ~200 characters |
| M4 | Do not inject Mission Log when journal is empty or absent |

## Documentation

| ID | Description |
|----|-------------|
| D1 | Navigator guide explaining the "re-run with context" pattern |
| D2 | Document semantic ID best practices in system prompt guidelines |
